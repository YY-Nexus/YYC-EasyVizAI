# YYC³ EasyVizAI 轻量化WEB应用本地服务器部署指南

## 概述

本指南提供了YYC³ EasyVizAI项目的完整本地部署解决方案，适用于低门槛服务器环境。通过一键部署脚本和Docker容器化技术，实现快速、稳定的生产环境部署。

## 系统要求

### 最低配置
- **操作系统**: Linux (Ubuntu 20.04+) / CentOS 7+ / macOS 11+
- **CPU**: 2核心
- **内存**: 4GB RAM
- **存储**: 20GB 可用空间
- **网络**: 稳定的互联网连接

### 推荐配置
- **操作系统**: Ubuntu 22.04 LTS
- **CPU**: 4核心
- **内存**: 8GB RAM
- **存储**: 50GB SSD
- **网络**: 宽带连接

### 必需软件
- Docker 20.10+
- Docker Compose 2.0+
- Git
- curl/wget

## 快速部署

### 1. 克隆项目

```bash
git clone https://github.com/YY-Nexus/YYC-EasyVizAI.git
cd YYC-EasyVizAI
```

### 2. 一键部署

```bash
# 给部署脚本执行权限
chmod +x deploy.sh

# 执行一键部署
./deploy.sh
```

部署脚本将自动完成以下操作：
- ✅ 检查系统环境
- ✅ 创建必要目录
- ✅ 生成环境配置文件
- ✅ 构建和启动所有服务
- ✅ 执行数据库初始化
- ✅ 创建管理员账户
- ✅ 执行健康检查

### 3. 验证部署

部署完成后，可以通过以下地址访问：

- **前端应用**: http://localhost
- **后端API**: http://localhost/api
- **管理后台**: http://localhost/admin
- **健康检查**: http://localhost/health

默认管理员账户：
- 用户名: `admin`
- 密码: `admin123`

## 服务架构

### 核心服务组件

| 服务名称 | 端口 | 功能描述 |
|---------|------|----------|
| Nginx | 80/443 | 反向代理和静态文件服务 |
| Backend | 8000 | Django后端API服务 |
| Frontend | 3000 | React前端应用 |
| PostgreSQL | 5432 | 主数据库 |
| Redis | 6379 | 缓存和消息队列 |
| Neo4j | 7474/7687 | 图数据库 |
| MinIO | 9000/9001 | 对象存储服务 |
| Qdrant | 6333 | 向量数据库 |
| Celery | - | 异步任务处理 |

## 服务管理

### 基本操作命令

```bash
# 启动所有服务
docker-compose -f docker-compose.production.yml up -d

# 停止所有服务
docker-compose -f docker-compose.production.yml down

# 重启服务
docker-compose -f docker-compose.production.yml restart

# 查看服务状态
docker-compose -f docker-compose.production.yml ps

# 查看服务日志
docker-compose -f docker-compose.production.yml logs [service_name]
```

## 常见问题解决

### 1. 端口冲突
如果遇到端口冲突，可以修改 `.env.production` 文件中的端口配置：

```bash
# 修改端口配置
NGINX_HTTP_PORT=8080
NGINX_HTTPS_PORT=8443
```

### 2. 内存不足
```bash
# 检查内存使用
free -h
docker stats

# 清理系统缓存
sync && echo 3 > /proc/sys/vm/drop_caches
```

### 3. 磁盘空间不足
```bash
# 清理Docker资源
docker system prune -a

# 清理旧日志
find deployment/logs -name "*.log" -mtime +7 -delete
```

### 4. 服务启动失败
```bash
# 查看具体错误信息
docker-compose -f docker-compose.production.yml logs [service_name]

# 重启特定服务
docker-compose -f docker-compose.production.yml restart [service_name]
```

## 健康检查

系统提供多层健康检查：

1. **应用健康检查**: http://localhost/health
2. **API状态检查**: http://localhost/api/v1/status/
3. **容器健康检查**: `docker-compose ps`

## 日志管理

### 日志文件位置
```
deployment/logs/
├── nginx/          # Nginx日志
├── app/           # 应用日志
├── celery/        # 任务日志
└── backups/       # 备份日志
```

### 日志查看
```bash
# 实时查看日志
docker-compose -f docker-compose.production.yml logs -f

# 查看特定服务日志
docker-compose -f docker-compose.production.yml logs nginx
```

## 数据备份

系统自动执行：
- **日志备份**: 每日压缩7天前的日志
- **数据库备份**: 每日备份，保留7天
- **清理策略**: 自动删除30天前的备份文件

### 手动备份
```bash
# 数据库备份
docker-compose -f docker-compose.production.yml exec postgres pg_dump -U easyviz easyviz > backup.sql

# 完整数据备份
tar -czf backup_$(date +%Y%m%d).tar.gz deployment/data/
```

## 安全建议

1. **修改默认密码**: 部署后立即修改管理员密码
2. **配置防火墙**: 只开放必要端口 (80, 443)
3. **启用HTTPS**: 配置SSL证书
4. **定期更新**: 保持系统和应用更新

## 性能优化

1. **系统优化**:
   ```bash
   # 增加文件描述符限制
   echo '* soft nofile 65536' >> /etc/security/limits.conf
   echo '* hard nofile 65536' >> /etc/security/limits.conf
   ```

2. **Docker优化**:
   ```bash
   # 配置日志大小限制
   echo '{"log-driver":"json-file","log-opts":{"max-size":"10m","max-file":"3"}}' > /etc/docker/daemon.json
   ```

## 技术支持

如遇到问题，请：
1. 查看本文档的常见问题部分
2. 检查服务日志获取错误信息
3. 在GitHub提交Issue: https://github.com/YY-Nexus/YYC-EasyVizAI/issues

---

**版本**: v1.0.0  
**维护**: YY-Nexus团队